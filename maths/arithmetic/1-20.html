<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"></link>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script type="text/javascript">
    var greenTick = "../images/greentick-64.ico"
    var redCross = "../images/redcross-64.ico"
    var operation = "subtract"
    var maxQuestions = 20;
    var questionNumber = 0;
    var results = {}
    results["questions"] = []
    function randomNumber(min, max) { 
      let randomNum = Math.random() * (max - min) + min;
      return Math.floor(randomNum)
    } 

    function checkAnswer(){
      $("#submitButton").prop( "disabled", true );
      
      $("#result").prop( "disabled", true );
      let addend1 = parseInt($("#addend-1").text())
      let addend2 = parseInt($("#addend-2").text())
      let operator = $("#operator").text()
      let userAnswer = parseInt($("#result").val())
      let expected = null
      switch( operator) {
        case '+':
          expected = addend1 + addend2
          break;
        case '-':
          expected = addend1 - addend2
        break;
      }
      console.log("addend1: " + addend1)
      console.log("addend2: " + addend2)
      console.log("expected: " + expected)
      console.log("userAnswer: " + userAnswer)
      console.log(operator)

      let questionResult = "wrong";
      if ( expected == userAnswer) {
        $("#validation").attr("src", greenTick).show()
        questionResult = "right"
      }else{
        $("#validation").attr("src", redCross).show()
        questionResult = "wrong"
        
      }
      results["questions"].push(questionResult)

      if (questionNumber >= maxQuestions){
        showResults()
      }else{
        $("#nextButton").show()
        $("#nextButton").prop("disabled", false )
      }
      
    }
    function getNextQuestion(){
      $("#result").prop( "disabled", false );
      $("#result").val("")
      $("#validation").hide()
      questionNumber++

      if (questionNumber >=  maxQuestions){
        $("#nextButton").hide();
      }

      let number1 = randomNumber(10, 20)
      let number2 = randomNumber(1, 20)
      if ( number1 > number2){
        $("#addend-1").text(number1)
        $("#addend-2").text(number2)
      }else{
        $("#addend-1").text(number2)
        $("#addend-2").text(number1)
      }
      switch(operation){
        case 'subtract':
          $("#operator").text("-");
          break;
        case 'add':
          $("#operator").text("+");
          break; 
      }
      $("#nextButton").prop("disabled", true )
      $("#submitButton").prop( "disabled", false );
    }
    function showResults(){
      console.log(JSON.stringify(results));
      let numRight = 0;
      let numWrong = 0;
      for ( let i=0; i<results["questions"].length; i++){
          if ( results["questions"][i] == "right"){
            numRight++
            continue;
          }
          numWrong++;
      }
      $("#right").html(numRight)
      $("#wrong").html(numWrong)
      $("#resultsDiv").show()
      $("#nextTest").show()

    }

    function nextTest(){
      location.reload();
    }
    $(function() {
      $("#resultsDiv").hide()
      $("#nextTest").hide()
      getNextQuestion()
    })
  </script>
  <style>
    .question{
      border: none;
    }
    .question, .answer {
      font-size: 60px;
      text-align: center;
    }
    #buttonsDiv{
      margin-top: 40px;
    }
    #title{
      margin-bottom: 40px;
      color: #351c75;
    }
    #validation{
      margin-top: 20px;
      margin-left: 20px;
    }
    .report.right{
      font-size: 24px;
      color: green;
    }
    .report.wrong{
      font-size: 24px;
      color:red;
    }

  </style>
</head>
<body class='bg-white'>
  <div class="container">
    <h1 id="title">Subtraction</h1>
    <div class="row">
      <div class="col-sm-1">
        <p class="question" id="addend-1"></p>
      </div>
      <div class="col-sm-1">
        <p class="question" id="operator"></p>
      </div>
      <div class="col-sm-1">
        <p class="question" id="addend-2"></p>
      </div>
      <div class="col-sm-1">
        <p class="question" id="equals">=</p>
      </div>
      <div class="col-sm-1">
        <input type="text" class="answer" id="result" required minlength="1" maxlength="2" size="2">
      </div>
      <div class="col-sm-1">
        <img id="validation">
      </div>
    </div>
    <div class="row" id="buttonsDiv">
      <div class="col-sm-3 col-md-3"></div>
      <div class="col-sm-2 col-md-1">
        <button type="button" id="submitButton" class="btn btn-info" onclick="checkAnswer()">Submit</button>
      </div>
      <div class="col-sm-2 col-md-1">
        <button type="button" id="nextButton" class="btn btn-info" onclick="getNextQuestion()">Next</button>
      </div>
      <div class="col-sm-1 col-md-1">
      </div>
      <div class="col-sm-1 col-md-1">
        <button type="button" id="nextTest" class="btn btn-secondary" onclick="nextTest()">Take next test</button>
      </div>

      <div class="col-sm-5 col-md-5"></div>
    </div>
    <div class="row" id="resultsDiv">
      <div class="col-sm-3">
        <div class="row">
          <div class="col-sm-6">
            <p class="report right">Correct</p>
          </div>
          <div class="col-sm-6">
            <p class= "report right" id="right"></p>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6">
            <p class="report wrong">Incorrect</p>
          </div>
          <div class="col-sm-6">
            <p class= "report wrong" id="wrong"></p>
          </div>
        </div>
      </div>
      </div>
    </div>
    
  </div>
</body>
</html>
